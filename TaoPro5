import requests
import os, sys, json, re
from time import sleep
session = requests.Session()
import os, sys, re, json
from time import sleep
import random
from datetime import datetime
import requests
import uuid
from datetime import datetime


def Reg(cookies,fb_dtsg,name,proxy):
	if proxy.count(":") == 3:
		pr = proxy.split(":")
		pr = "%s:%s@%s:%s"%(pr[2], pr[3], pr[0], pr[1])
	else:
		pr = proxy
	choose = "http"
	proxies = {"http": f"{choose}://{pr}" ,"https": f"{choose}://{pr}"}
	try:
		id_acc = cookies.split('c_user=')[1].split(';')[0]
		headers = {
			'authority': 'www.facebook.com',
			'accept': '*/*',
			'accept-language': 'vi-VN,vi;q=0.9,fr-FR;q=0.8,fr;q=0.7,en-US;q=0.6,en;q=0.5',
			'cookie': cookies,
			'origin': 'https://www.facebook.com',
			'referer': 'https://www.facebook.com/pages/creation?ref_type=launch_point',
			'sec-ch-prefers-color-scheme': 'dark',
			'sec-ch-ua': '"Google Chrome";v="107", "Chromium";v="107", "Not=A?Brand";v="24"',
			'sec-ch-ua-mobile': '?0',
			'sec-ch-ua-platform': '"Windows"',
			'sec-fetch-dest': 'empty',
			'sec-fetch-mode': 'cors',
			'sec-fetch-site': 'same-origin',
			'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/107.0.0.0 Safari/537.36',
			'viewport-width': '979',
			'x-fb-friendly-name': 'AdditionalProfilePlusCreationMutation',
			'x-fb-lsd': 'ZM7FAk6cuRcUp3imwqvHTY',
		}

		data = {
			'av': id_acc,
			'__user': id_acc,
			'__a': '1',
			'__dyn': '7AzHxq1mxu1syUbFuC0BVU98nwgU29zEdEc8co5S3O2S7o11Ue8hw6vwb-q7oc81xoswIwuo886C11xmfz81sbzoaEnxO0Bo7O2l2Utwwwi831wiEjwZwlo5qfK6E7e58jwGzE8FU5e7oqBwJK2W5olwuEjUlDw-wUws9ovUaU3qxWm2Sq2-azo2NwkQ0z8c84K2e3u362-2B0oobo',
			'__csr': 'gP4ZAN2d-hbbRmLObkZO8LvRcXWVvth9d9GGXKSiLCqqr9qEzGTozAXiCgyBhbHrRG8VkQm8GFAfy94bJ7xeufz8jK8yGVVEgx-7oiwxypqCwgF88rzKV8y2O4ocUak4UpDxu3x1K4opAUrwGx63J0Lw-wa90eG18wkE7y14w4hw6Bw2-o069W00CSE0PW06aU02Z3wjU6i0btw3TE1wE5u',
			'__req': 't',
			'__hs': '19296.HYP:comet_pkg.2.1.0.2.1',
			'dpr': '1',
			'__ccg': 'EXCELLENT',
			'__rev': '1006496476',
			'__s': '1gapab:y4xv3f:2hb4os',
			'__hsi': '7160573037096492689',
			'__comet_req': '15',
			'fb_dtsg': fb_dtsg,
			'jazoest': '25404',
			'lsd': 'ZM7FAk6cuRcUp3imwqvHTY',
			'__aaid': '800444344545377',
			'__spin_r': '1006496476',
			'__spin_b': 'trunk',
			'__spin_t': '1667200829',
			'fb_api_caller_class': 'RelayModern',
			'fb_api_req_friendly_name': 'AdditionalProfilePlusCreationMutation',
			'variables': '{"input":{"bio":"","categories":["181475575221097"],"creation_source":"comet","name":"'+name+'","page_referrer":"launch_point","actor_id":"'+id_acc+'","client_mutation_id":"1"}}',
			'server_timestamps': 'true',
			'doc_id': '5903223909690825',
		}
		
		response = requests.post('https://www.facebook.com/api/graphql/', headers=headers, data=data, proxies=proxies, timeout=20)
		
		sleep(2)
		idpage=response.json()['data']['additional_profile_plus_create']['additional_profile']['id']
		cookies='i_user='+idpage+';'+cookies
		print('Tạo Thành Công :'+idpage,end='\r')
		
		try:return cookies,fb_dtsg
		except:
			return response.text
	except:pass

def UpAVT(cookiesFB,fb_dtsgFB,idpro5):
	fheaders= {
         'authority': 'www.facebook.com',
         'accept': '*/*',
         'accept-language': 'vi-VN,vi;q=0.9,fr-FR;q=0.8,fr;q=0.7,en-US;q=0.6,en;q=0.5',
         'cookie': cookiesPro5,
         'origin': 'https://www.facebook.com',
         'referer': 'https://www.facebook.com'+idpro5,
         'sec-ch-prefers-color-scheme': 'dark',
         'sec-ch-ua': '"Google Chrome";v="107", "Chromium";v="107", "Not=A?Brand";v="24"',
         'sec-ch-ua-mobile': '?0',
         'sec-ch-ua-platform': '"Windows"',
         'sec-fetch-dest': 'empty',
         'sec-fetch-mode': 'cors',
         'sec-fetch-site': 'same-origin',
         'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/107.0.0.0 Safari/537.36',
         'viewport-width': '979',
         'x-fb-friendly-name': 'AdditionalProfilePlusCreationMutation',
         'x-fb-lsd': 'ZM7FAk6cuRcUp3imwqvHTY',
         'viewport-width': '1366',}
	datas = {
	       	'av': idpro5,
			'__user': idpro5,
			'fb_dtsg': fb_dtsgPro5,
			'jazoest': '25387',
			'variables': '{"input":{"attribution_id_v2":"ProfileCometTimelineListViewRoot.react,comet.profile.timeline.list,via_cold_start,1682522236720,948878,190055527696468,","caption":"","existing_photo_id":"'+IDANH+'","expiration_time":null,"profile_id":"'+idpro5+'","profile_pic_method":"EXISTING","profile_pic_source":"TIMELINE","scaled_crop_rect":{"height":0.80058,"width":1,"x":0,"y":0.09971},"skip_cropping":true,"actor_id":"'+idpro5+'","client_mutation_id":"1"},"isPage":false,"isProfile":true,"sectionToken":"UNKNOWN","collectionToken":"UNKNOWN","scale":1}',
			'server_timestamps': 'true',
			'doc_id': '6041079162654149',
	}
	print(f"Đang Up Ảnh Làm Avata ID:{idpro5}                   ",end='\r')
	sleep(5)
	response = requests.post('https://www.facebook.com/api/graphql/', headers=fheaders, data=datas) 
	print("Up Ảnh Thành Công                           ",end='\r')
	idfb=cookiesPro5.split("c_user=")[1].split(';')[0]
	print(f'> Thành Công {idfb}|{idpro5}')
	file.read(f'{idfb}|{idpro5}')
sopagemountao=int(input('[T]> Số Page Muốn Tạo Trên Mỗi FB : '))
dl = int(input("[T]> Điền Delay :"))
proxy=input("Điền Proxy : ")
sttck=0
ALLINPUT=[]
while True:
	if proxy.count(":") == 3:
		pr = proxy.split(":")
		pr = "%s:%s@%s:%s"%(pr[2], pr[3], pr[0], pr[1])
	else:
		pr = proxy
	choose = "http"
	proxies = {"http": f"{choose}://{pr}" ,"https": f"{choose}://{pr}"}
	sttck+=1
	print('                                               ',end='\r')
	cookiesFB=input(f"Điền Cookie FB Cần Reg {sttck} : ")
	if len(cookiesFB) >=10:
		print("ĐANG KIỂM TRA COOKIE ......",end='\r')
		try:
			headers = {
				'authority': 'www.facebook.com',
				'accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9',
				'accept-language': 'vi',
				'cookie': cookiesFB,
				'sec-ch-prefers-color-scheme': 'light',
				'sec-ch-ua': '"Chromium";v="106", "Google Chrome";v="106", "Not;A=Brand";v="99"',
				'sec-ch-ua-mobile': '?0',
				'sec-ch-ua-platform': '"Windows"',
				'sec-fetch-dest': 'document',
				'sec-fetch-mode': 'navigate',
				'sec-fetch-site': 'none',
				'sec-fetch-user': '?1',
				'upgrade-insecure-requests': '1',
				'user-agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X x.y; rv:42.0) Gecko/20100101 Firefox/42.0',
				'viewport-width': '1366',
			}
			url_profile = requests.get('https://www.facebook.com/me', headers=headers, proxies=proxies, timeout=20).url
			profile = requests.get(url_profile, headers=headers, proxies=proxies, timeout=20).text
			try:
				fb_dtsgFB = profile.split('{"name":"fb_dtsg","value":"')[1].split('"},')[0]
			except:
				fb_dtsgFB = profile.split(',"f":"')[1].split('","l":null}')[0]
			ALLINPUT.append(f'{cookiesFB}|{fb_dtsgFB}|{proxy}')
		except:
			print("Cookie DIE")
			quit()
	else:break
print("")
print("=========================[ Bắt Đầu Chạy ]=======================")
print("")

dem = 0
def delay(dl):
   t=datetime.now().strftime("%H:%M")
   for ti in range(int(dl) , 0, -1):
   	print(f"</> Đang Delay Tạo Pro5 {ti}s                   ",end='\r')
   	sleep(1)
mylist = ["101706786252767", "117567931316862", "101613956262598"]
for i in ALLINPUT:
	cookiesFB=i.split("|")[0]
	fb_dtsgFB=i.split("|")[1]
	proxy=i.split("|")[2]
	try:
		for sll in range(sopagemountao):
			IDANH=random.choice(mylist)
			arraylot = ["Công", "Đức", "Duy", "Gia", "Anh", "Hồng", "Đinh", "Quốc", "Quỳnh","Vĩnh"]
			arrayten = ["Hưng","Anh", "Văn", "Tuấn", "Hoàng", "Quốc", "Năm", "Giang", "Khang", "Dương", "Phúc", "Thiên", "Hùng", "Kiệt", "Châu", "Quỳnh", "huệ", "Tuấn", "Khánh", "Trân", "Yên", "Lợi", "Danh", "Vinh", "Nhi", "Nhí", "Quốc", "Anh", "Danh", "Hân", "Giang","Phán"]
			ho = 'ThuanCoder2006'
			lot = random.choice(arraylot)
			ten = random.choice(arrayten)
			name = str(ho+' '+lot+' '+ten)
			dem = dem+1
			cookiesPro5,fb_dtsgPro5=Reg(cookiesFB,fb_dtsgFB,name,proxy)
			idpro5=cookiesPro5.split('i_user=')[1].split(";")[0]
			UpAVT(cookiesFB,fb_dtsgFB,idpro5)
	except:
		id_acc = cookiesFB.split('c_user=')[1].split(';')[0]
		print(f"Đã Bị Chặn Tạo Page IDFB : {id_acc}")
		delay(dl);
		
